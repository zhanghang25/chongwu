{include file="pageheader"}
<div class="wrapper shop_special">
	<div class="title">小程序设置</div>
	<div class="content_tips">
		<div class="explanation" id="explanation">
        	<div class="ex_tit"><i class="sc_icon"></i><h4>操作提示</h4><span id="explanationZoom" title="收起提示"></span></div>
            <ul>
            	<li>一、配置前先 <a href="https://mp.weixin.qq.com/debug/wxadoc/introduction/index.html" target="_blank">注册小程序</a>，进行微信认证, 已有微信小程序 <a href="https://mp.weixin.qq.com/" target="_blank"/>立即登录</a></li>
            	<li>二、登录 <a href="https://mp.weixin.qq.com/" target="_blank"/>微信公众号平台 </a>后，在 设置 - 开发者设置 中，查看到微信小程序的 AppID、Appsecret，并配置填写好域名。（注意不可直接使用微信服务号或订阅号的 AppID、AppSecret）</li>
            	<li>三、微信认证后，开通小程序微信支付。开通后，配置小程序微信支付的商户号和密钥。 </li>
            </ul>
        </div>
		<div class="flexilist">
			<div class="main-info">
				<!--<div class="panel-heading">{$lang['edit_wechat']}</div>-->
				<form method="post" action="{url('index')}" class="form-horizontal" role="form">
					<div class="switch_info">
						<div class="item">
							<div class="label-t">{$lang['wx_appname']}</div>
							<div class="label_value">
								<input type="text" name="data[wx_appname]" class="text" value="{$data['wx_appname']}"/>
								<div class="notic"> {$lang['wx_appname']}</div>
							</div>
						</div>
						<div class="item">
							<div class="label-t">{$lang['wx_appid']}</div>
							<div class="label_value">
								<input type="text" name="data[wx_appid]" class="text" value="{$data['wx_appid']}">
								<div class="notic">* {$lang['wxapp_help1']}</div>
							</div>
						</div>
						<div class="item">
							<div class="label-t">{$lang['wx_appsecret']}</div>
							<div class="label_value">
								<input type="text" name="data[wx_appsecret]" class="text" value="{$data['wx_appsecret']}">
								<div class="notic">* {$lang['wxapp_help2']}</div>
							</div>
						</div>
						<div class="item">
							<div class="label-t">{$lang['wx_mch_id']}</div>
							<div class="label_value">
								<input type="text" name="data[wx_mch_id]" class="text" value="{$data['wx_mch_id']}">
								<div class="notic">* {$lang['wxapp_help3']}</div>
							</div>
						</div>
						<div class="item">
							<div class="label-t">{$lang['wx_mch_key']}</div>
							<div class="label_value">
								<input type="text" name="data[wx_mch_key]" class="text" value="{$data['wx_mch_key']}">
								<div class="notic">* {$lang['wxapp_help4']}</div>
							</div>
						</div>
						<div class="item">
							<div class="label-t">{$lang['token_secret']}</div>
							<div class="label_value">
								<input type="text" name="data[token_secret]" class="text" value="{$data['token_secret']}">
								<div class="notic">
								<span class="btn btn-success makeToken">生成Token</span>
								<!-- <span class="btn btn-info btn-xs copyToken">复制Token</span> -->
								* {$lang['wxapp_help5']}
								</div>
							</div>
						</div>

						<div class="item">
							<div class="label-t">{$lang['wechat_status']}</div>
							<div class="label_value">
								<div class="checkbox_items">
		                            <div class="checkbox_item">
					                    <input type="radio" name="data[status]" class="ui-radio event_zhuangtai" id="value_118_0" value="1" {if $data['status'] == 1}checked{/if}>
					                    <label for="value_118_0" class="ui-radio-label {if $data['status']==1}active{/if}">{$lang['wechat_open']}</label>
					                </div>
					                <div class="checkbox_item">
					                    <input type="radio" name="data[status]" class="ui-radio event_zhuangtai" id="value_118_1" value="0" {if $data['status'] == 0}checked{/if}>
					                    <label for="value_118_1" class="ui-radio-label {if $data['status'] == 0}active{/if}">{$lang['wechat_close']}</label>
					                </div>
                                </div>
							</div>
						</div>
						<div class="item">
							<div class="label-t">&nbsp;</div>
							<div class="label_value info_btn">
								<input type="hidden" name="id" value="{$data['id']}" />
								<input type="submit" name="submit" value="{$lang['button_save']}" class="button btn-danger bg-red" />
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<script>
	// H5 复制粘贴 - execCommand http://www.jianshu.com/p/37322bb86a48  兼容IE8+，Chrome 45+, Firefox 43+
	// var copyToken = document.querySelector('.copyToken');
	// copyToken.onclick = function() {
	// 	var newtoken = $("input[name='data[token_secret]']").val();
	// 	copyTextToClipboard(newtoken);
	// }

	function copyTextToClipboard(text) {
		var textArea = document.createElement("textarea");
		textArea.style.position = 'fixed';
		textArea.style.top = 0;
		textArea.style.left = 0;
		textArea.style.width = '2em';
		textArea.style.height = '2em';
		textArea.style.padding = 0;
		textArea.style.border = 'none';
		textArea.style.outline = 'none';
		textArea.style.boxShadow = 'none';
		textArea.style.background = 'transparent';
		textArea.value = text;
		document.body.appendChild(textArea);

		textArea.select();
		try {
			var msg = document.execCommand('copy') ? '成功' : '失败';
			console.log('复制内容 ' + msg);
			layer.msg('复制内容 ' + msg);
		} catch (err) {
			console.log('浏览器不支持此复制方法');
			layer.msg('浏览器不支持此复制方法');
		}
		document.body.removeChild(textArea);
	}


	// 生成token md5
	$(".makeToken").click(function(){
		var mydate = new Date();
		var mytime = mydate.toLocaleTimeString(); //获取当前时间
		var token = $.md5(mytime);
		$("input[name='data[token_secret]']").val(token);
	});

</script>

{include file="pagefooter"}
